<ul class="album-item-list">
  <template id="template">
    <li>
      <img src="" alt="" class="image" />
    </li>
  </template>
</ul>

<style>
  .album-item-list {
    display: grid;
    gap: 0.5em;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    list-style: none;
    min-height: 50vh;
    padding: 0;
  }

  .image {
    object-fit: cover;
  }
</style>

<script>
  import { ENDPOINT_MEDIA_PATH } from "@/constants/config";
  import { fetchFileList } from "@/scripts/fetchFileList";

  const GALLERY_PATH = "youth-fellowship-camp-2025/photo-gallery/";
  const ENDPOINT = `${ENDPOINT_MEDIA_PATH}${GALLERY_PATH}`;

  (async () => {
    const template = document.getElementById("template") as HTMLTemplateElement;
    const ul = document.querySelector(".album-item-list") as HTMLUListElement;
    const fragment = document.createDocumentFragment();

    try {
      const res = await fetchFileList(GALLERY_PATH);

      if (res.status !== "success") {
        console.error("fetchFileList error:", res.message);
        return;
      }

      const files = res.list
        .filter((item) => item.type === "file")
        .sort(() => Math.random() - 0.5);

      for (const file of files) {
        const clone = template.content.cloneNode(true) as DocumentFragment;
        const image = clone.querySelector(".image") as
          | HTMLImageElement
          | HTMLSourceElement;
        image.src = `${ENDPOINT}${file.name}`;
        fragment.appendChild(clone);
      }

      ul.appendChild(fragment);
    } catch (err) {
      console.error("Unexpected error in createAlbum:", err);
    }
  })();
</script>
